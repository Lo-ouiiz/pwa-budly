generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

enum SponsorshipStatus {
  ACTIF
  EN_PAUSE
  ANNULE
  EXPIRE
}

enum PersonalityTrait {
  Solitaire
  Sociable
  Affectueux
  Territorial
  Protecteur
  Indépendant
  Amical
  Curieux
  Paresseux
  Energique
  Joueur
  Endormi
  Timide
  Audacieux
  Colérique
  Calme
  Sensible
  Méfiant
  Joyeux
  Drôle
  Grognon
  Mystérieux
  Fier
  Arrogant
  Charmant
  Majestueux
}

enum UserRole {
  ZOO_ADMIN
  ZOO_USER
  USER
}

enum ConservationStatus {
  NE
  NA
  DD
  LC
  NT
  VU
  EN
  CR
  RE
  EW
  EX
}

model User {
  id            Int       @id @default(autoincrement())
  role          UserRole  @default(USER)
  firstName     String
  lastName      String
  email         String    @unique
  passwordHash  String
  birthDate     DateTime
  street        String
  postalCode    String
  city          String
  country       String
  phoneNumber   String?
  createdAt     DateTime  @default(now())

  traits        PersonalityTrait[]
  sponsorships  Sponsorship[]
  invoices      Invoice[]
}

model Zoo {
  id            Int      @id @default(autoincrement())
  name          String
  slug          String   @unique
  street        String
  postalCode    String
  city          String
  country       String
  logo          String
  labels        String[]
  photos        String[]
  description   String
  deletedAt     DateTime?

  animals       Animal[]
  plans         SponsorshipPlan[]
}

model Animal {
  id                     Int       @id @default(autoincrement())
  name                   String
  slug                   String    @unique
  photos                 String[]
  species                String
  subSpecies             String?
  age                    Int
  gender                 String
  conservationStatus     ConservationStatus
  birthDate              DateTime?
  birthPlace             String?
  story                  String?
  description            String
  naturalHabitat         String
  diet                   String?
  weight                 Float?
  size                   Float?
  physicalSpecificity    String?
  lifeExpectancyYears    Int?
  sponsorshipImpact      String?
  deletedAt              DateTime?

  zooId                  Int
  zoo                    Zoo             @relation(fields: [zooId], references: [id])

  traits                 PersonalityTrait[]
  sponsorships           Sponsorship[]

  @@index([zooId])
}

model SponsorshipPlan {
  id                Int       @id @default(autoincrement())
  name              String
  description       String
  basePrice         Float
  taxReducedPrice   Float?
  benefits          String
  durationMonths    Int
  deletedAt         DateTime?

  zooId             Int
  zoo               Zoo       @relation(fields: [zooId], references: [id])

  sponsorships      Sponsorship[]

  @@index([zooId])
}

model Sponsorship {
  id                   Int       @id @default(autoincrement())
  status               SponsorshipStatus
  startDate            DateTime
  endDate              DateTime?
  monthlyAmount        Float
  autoRenew            Boolean   @default(false)
  createdAt            DateTime  @default(now())

  userId               Int
  user                 User      @relation(fields: [userId], references: [id])

  animalId             Int
  animal               Animal    @relation(fields: [animalId], references: [id])

  planId               Int
  plan                 SponsorshipPlan @relation(fields: [planId], references: [id])

  invoices             Invoice[]

  @@index([userId])
  @@index([animalId])
  @@index([planId])
}

model Invoice {
  id              Int       @id @default(autoincrement())
  amount          Float
  issuedAt        DateTime  @default(now())
  paid            Boolean   @default(false)
  pdfUrl          String?

  userId          Int
  user            User      @relation(fields: [userId], references: [id])

  sponsorshipId   Int?
  sponsorship     Sponsorship? @relation(fields: [sponsorshipId], references: [id])

  @@index([userId])
  @@index([sponsorshipId])
}
